# S3 Integration

Live Agora uses the S3 protocol for image and sound file uploads. For instance administrators, the following one-time setup is required.

## 1. Setup an S3 bucket

1. Create an S3 bucket (i.e. with Minio, or hosted i.e. Scaleway Object Storage)
2. Create an API key
3. Give the key access to bucket created
4. Add CORS rules, i.e. with aws cli: `./aws s3api put-bucket-cors --bucket test-bucket --cors-configuration file://S3-example-cors.json`
   
```json
{
  "CORSRules": [
    {
        "AllowedOrigins": ["*"],
        "AllowedHeaders": ["*"],
        "AllowedMethods": ["PUT", "POST", "DELETE"],
        "MaxAgeSeconds": 3000,
        "ExposeHeaders": ["x-amz-server-side-encryption"]
    },
    {
        "AllowedOrigins": ["*"],
        "AllowedHeaders": ["Authorization"],
        "AllowedMethods": ["GET"],
        "MaxAgeSeconds": 3000
    }
  ]
}
```
5. Add public read access policy
```
{
  "Sid": "Public access to s3:GetObject",
  "Effect": "Allow",
  "Principal": "*",
  "Action": "s3:GetObject",
  "Resource": "<bucketname>/*"
},
```

## 2. Add values to `packages/server/.env` file:

```
OBJECT_STORAGE_ENDPOINT=your_s3_endpoint_here
OBJECT_STORAGE_DEFAULT_REGION=your_s3_region_here
OBJECT_STORAGE_BUCKET=your_s3_bucket_name_here
OBJECT_STORAGE_ACCESS_KEY_ID=your_s3_access_key_id_here
OBJECT_STORAGE_SECRET_ACCESS_KEY=your_s3_secret_access_key_here
```